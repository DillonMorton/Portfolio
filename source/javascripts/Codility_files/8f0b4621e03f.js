var Console={level:"ERROR",setLevel:function(level){this.level=level},_levelValue:function(level){if(level=="ERROR")return 40;if(level=="WARNING")return 30;if(level=="INFO")return 20;if(level=="DEBUG")return 10;return 0},filter:function(log_level){var act_value=this._levelValue(this.level);var value=this._levelValue(log_level);if(value>=act_value)return true;else return false},log:function(log_level,type,msg){var curr_level=this._levelValue(this.level);var this_level=this._levelValue(log_level);if(this_level>=curr_level)this._log(log_level,type,msg)},_log:function(log_level,type,msg){var msgtxt;if(msg){msgtxt=type+","+msg}else{msgtxt=type}var color="black";if(log_level=="ERROR"){color="red"}$("#console").append('<div style="color:'+color+';">'+msgtxt+"</div><br/>");$("#console").scrollTop($("#console").prop("scrollHeight"))},_msg:function(msg,color){if(!color)color="black";$("#console").append('<div style="color:'+color+';">'+msg+"</div><br/>");$("#console").scrollTop($("#console").prop("scrollHeight"))},addHtml:function(html){$("#console").append(html)},msg:function(msg){Log.info("candidate console message",msg);this._msg(msg,"black")},msg_error:function(msg){Log.info("candidate console message",msg);this._msg(msg,"red")},msg_ok:function(msg){Log.info("candidate console message",msg);this._msg(msg,"green")},msg_quote:function(msg){Log.info("candidate console message",msg);$("#console").append('<div class="quote">'+msg+"</div>");$("#console").scrollTop($("#console").prop("scrollHeight"))},msg_syserr:function(msg){Log.warning("candidate console message",msg);this._msg(msg,"red")},clear:function(){Log.info("candidate console clear");$("#console").html("")},add_loader:function(msg){var $loader=$(".loader").clone();$loader.find(".message").text(msg);$("#console").append($loader);$loader.show()},add_loader_comment:function(comment){$("#console .loader .comment").text(comment)},remove_loader:function(){$("#console .loader").remove()}};var Diff={};Diff.splitLines=function(content){if(content==="")return[];content=content.replace(/([^\t\n ])[\t ]+/g,"$1 ");content=content.replace(/ +$/gm,"");return content.split(/\r?\n/)};Diff.findChanges=function(oldTokens,newTokens){var maxEditLength=oldTokens.length+newTokens.length;var bestPath={};bestPath[0]={x:-1,y:-1,changes:""};function advance(path){while(path.x+1<oldTokens.length&&path.y+1<newTokens.length&&oldTokens[path.x+1]==newTokens[path.y+1]){path.x++;path.y++;path.changes+="0"}}advance(bestPath[0]);if(bestPath[0].x==oldTokens.length-1&&bestPath[0].y==newTokens.length-1)return bestPath[0].changes;for(var d=1;d<=maxEditLength;d++){for(var k=-d;k<=d;k+=2){var path={};if(bestPath[k+1]!==undefined&&(bestPath[k-1]===undefined||bestPath[k-1].x<bestPath[k+1].x)){path.x=bestPath[k+1].x;path.y=bestPath[k+1].y+1;path.changes=bestPath[k+1].changes+"+"}else if(bestPath[k-1]!==undefined){path.x=bestPath[k-1].x+1;path.y=bestPath[k-1].y;path.changes=bestPath[k-1].changes+"-"}else{continue}advance(path);bestPath[k]=path;if(path.x==oldTokens.length-1&&path.y==newTokens.length-1){var simpleChanges=Diff.simpleFindChanges(d,oldTokens,newTokens);if(simpleChanges!==null)return simpleChanges;else return path.changes}}}};Diff.simpleFindChanges=function(maxEditLength,oldTokens,newTokens){if(oldTokens.length!=newTokens.length)return null;var d=0;var changes="";var i=0;while(i<oldTokens.length){if(oldTokens[i]==newTokens[i]){changes+="0";i++}else{var end;for(end=i+1;end<oldTokens.length&&oldTokens[end]!=newTokens[end];end++);var length=end-i;d+=length*2;if(d>maxEditLength)return null;var k;for(k=0;k<length;k++)changes+="-";for(k=0;k<length;k++)changes+="+";i+=length}}return changes};Diff.analyze=function(template,solution){var oldLines=Diff.splitLines(template);var newLines=Diff.splitLines(solution);var changes=Diff.findChanges(oldLines,newLines);var nChanged=0;var highlightChanged=[],highlightRemoved=[];var posOld=0,posNew=0;while(changes!==""){var m=/^(-*)(\+*)/.exec(changes);if(m[0].length>0){var n=m[0].length,nRemoved=m[1].length,nAdded=m[2].length;var nRemovedNoEmpty=nRemoved,nAddedNoEmpty=nAdded;var i;for(i=0;i<nAdded;i++){if(newLines[posNew+i]!=="")highlightChanged.push(posNew+i);else nAddedNoEmpty--}for(i=0;i<nRemoved;i++){if(oldLines[posOld+i]==="")nRemovedNoEmpty--}if(nAddedNoEmpty===0&&nRemovedNoEmpty>0)highlightRemoved.push(posNew);posOld+=nRemoved;posNew+=nAdded;nChanged+=Math.max(nAddedNoEmpty,nRemovedNoEmpty);changes=changes.slice(n)}else{m=/^0*/.exec(changes);var nSame=m[0].length;posOld+=nSame;posNew+=nSame;changes=changes.slice(nSame)}}return{nChanged:nChanged,highlightChanged:highlightChanged,highlightRemoved:highlightRemoved}};function createCookie(name,value){value=encodeURIComponent(value);document.cookie=name+"="+value+"; path=/"}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i].trim();if(c.indexOf(nameEQ)===0){return decodeURIComponent(c.substring(nameEQ.length,c.length))}}return null}var TestCases={limit:5,focus:false,storage:window.sessionStorage,init:function(){this.count=0;this.allow_tree_editor=false;this.tree_editor=null;$("#add_test_case").click(function(e){e.preventDefault();if(TestCases.add()){$(".test-case input").last().focus();if(TestCases.allow_modal_editor)TestCases.show_modal_for_input($(".test-case input").last())}});var that=this;$("#test_cases").on("change keyup paste","input",function(){that.save()});$("#tree_editor").jqm({modal:true});this.update()},enable_modal_editor:function(modal_editor_options){this.allow_modal_editor=true;this.modal_editor_options=modal_editor_options;$("#test_cases").removeClass("hide-edit")},disable_modal_editor:function(){this.allow_modal_editor=false;this.modal_editor_options=null;$("#test_cases").addClass("hide-edit")},update:function(){$("#add_test_case .counter").text(this.count+"/"+this.limit);if(this.count>=this.limit){$("#add_test_case").addClass("limit-reached")}else{$("#add_test_case").removeClass("limit-reached")}var value=$("input[name=test_case_example]").val()||"";var format="format: "+value;var width=$("#add_test_case .wide").width();var font_width=8;if(format.length>width/font_width){var length=Math.floor(width/font_width);format=format.slice(0,length-1)+"…"}$("#add_test_case .case-format").text(format);ui.updatePageLayout();this.save()},onChangeFocus:function(newFocus){var $title=$("#add_test_case .title");var $format=$("#add_test_case .case-format");var that=this;function transition($from,$to,requiredFocus){setTimeout(function(){if(that.focus!=requiredFocus)return;if($to.is(":visible"))return;$from.fadeOut(200,function(){$to.fadeIn(200)})},500);that.focus=requiredFocus}if(!this.focus&&newFocus){transition($title,$format,true)}else if(this.focus&&!newFocus){transition($format,$title,false)}},add:function(value){if(this.count>=this.limit)return false;Log.info("candidate add test case");var num=this.nextID;this.nextID++;this.count++;var $test_case=$("#example_test_case").clone();$test_case.addClass("test-case");$test_case.removeAttr("id");var $input=$test_case.find("input");$("#test_cases").append($test_case);$test_case.find(".remove").click(function(e){e.preventDefault();TestCases.remove($(this).closest(".test-case"))});$test_case.find(".edit").click(function(e){e.preventDefault();if(TestCases.allow_modal_editor)TestCases.show_modal_for_input($input)});$input.val(value);var that=this;$input.focus(function(){that.onChangeFocus(true)});$input.blur(function(){that.onChangeFocus(false)});this.update();return true},clean:function(){$(".test-case").each(function(i,tc){var value=$(tc).find("input").val();var value_clean=value.replace("−","-");value_clean=value_clean.replace(/[^ -]/g,"");if(value!==value_clean){$(tc).find("input").val(value_clean);Console.msg(value+" was changed to "+value_clean+". (Illegal Characters removed.)")}})},get_list:function(){var test_list=[];$(".test-case").each(function(i,tc){var value=$(tc).find("input").val();test_list.push(value)});return test_list},remove:function($elt){this.count--;Log.info("candidate remove test case");$elt.remove();this.update()},save:function(){if(!this.storage||!ui.task.loaded)return;var test_list_json=JSON.stringify(this.get_list());var name="test_cases_"+ui.options.ticket_id+"_"+ui.task.name;try{this.storage.setItem(name,test_list_json)}catch(e){if(e.message.toLowerCase().indexOf("quota")==-1){Log.error("error saving test cases to sessionStorage",e)}try{createCookie(name,test_list_json)}catch(e2){Log.error("error saving test cases to cookie",e2)}}},load:function(){if(!this.storage||!ui.task.loaded)return;try{var name="test_cases_"+ui.options.ticket_id+"_"+ui.task.name;var test_list_json=this.storage.getItem(name);if(!test_list_json){test_list_json=readCookie(name)}if(!test_list_json){return}var test_list=$.parseJSON(test_list_json);this.removeAll();for(var i=0;i<test_list.length;i++)this.add(test_list[i])}catch(e){Log.error("error loading test cases",e)}},removeAll:function(){this.count=0;$(".test-case").remove()},disable:function(){this.removeAll();$("#test_cases_area").hide();ui.updatePageLayout()},enable:function(){this.load();$("#test_cases_area").show();this.update()},show_modal:function($elt,input_string,on_ok,on_cancel){var self={};self.options=this.modal_editor_options;self.format=self.options.format;self.read_tuple=function(){try{return Trees.parse_tuple(input_string,self.format)}catch(e){Console.clear();Console.msg_error("Could not parse the test case: "+e.message);return null}};self.init=function(){var tuple=self.read_tuple();if(tuple===null)return;var tree_name=null;for(var i=0;i<self.format.length;i++){if(self.format[i].type=="tree"){tree_name=self.format[i].name;break}}if(tree_name===null){throw new Error("Format does not contain a tree")}var tree=tuple[tree_name];self.tree_editor=TreeEditor($elt.find(".tree-editor"),$elt.find(".undo"),$elt.find(".warnings"));self.tree_editor.set_tree(tree);if(self.options.bst)self.tree_editor.enable_bst_warning();self.int_editors={};for(i=0;i<self.format.length;i++){if(self.format[i].type=="tree")continue;var $param=self.create_input_for_param(self.format[i],tuple);$elt.find(".params").append($param)}$elt.find(".ok").click(self.handle_ok);$elt.find(".cancel").click(self.handle_cancel);Console.clear();$elt.jqmShow();self.tree_editor.update_tree()};self.destroy_modal=function(){$elt.jqmHide();$elt.find(".ok").unbind("click");$elt.find(".cancel").unbind("click");$elt.find(".params").empty();self.tree_editor.destroy()};self.get_tuple_string=function(){var tree=self.tree_editor.tree;var tuple={};for(var i=0;i<self.format.length;i++){if(self.format[i].type=="tree")tuple[self.format[i].name]=tree;else{var value=self.int_editors[self.format[i].name].get_value();if(value===null){Console.msg_error("Invalid value for parameter "+self.format[i].name+", using 0.");value=0}tuple[self.format[i].name]=value}}return Trees.serialize_tuple(tuple,self.format)};self.create_input_for_param=function(param,tuple){var $param=$('<div class="param"><span class="name"></span> = <input type="text"></input></div>');$param.find(".name").text(param.name);$param.find("input").val(tuple[param.name]);$param.attr("data-name",param.name);self.int_editors[param.name]=IntEditor($param.find("input"));return $param};self.handle_ok=function(e){e.preventDefault();var tuple_string=self.get_tuple_string();self.destroy_modal();on_ok(tuple_string)};self.handle_cancel=function(e){e.preventDefault();self.destroy_modal();on_cancel()};self.init()},show_modal_for_input:function($input){var tree_string=$input.val();if(tree_string==="")tree_string=$("input[name=test_case_example]").val();function on_ok(result_tree_string){$input.val(result_tree_string);TestCases.save()}function on_cancel(){if($input.val()===""){TestCases.remove($input.closest(".test-case"))}}try{this.show_modal($("#tree_editor"),tree_string,on_ok,on_cancel)}catch(e){$("#tree_editor").jqmHide();this.disable_modal_editor();Console.msg_error("Error opening the tree editor. Please edit the test case manually, or open the page in another browser.");Log.error("error opening tree editor",e)}}};var Help=function(isInitial,taskCount,prgLangName,prgLangCount,support_email){var self={support_email:support_email};self.stepsTexts={introduction:"Before you begin, we will guide you through the test interface.<br>"+"The timer will start with your confirmation after this presentation is over.<br>"+"You can skip this presentation at any time.",problemDescription:"Read the problem description.",tasksTab:"You can see all the tasks here."+" You can switch freely between them.",timer:"The timer is counting down the time for the whole test. "+"If you do not manage to submit all the tasks before the "+"time runs out, we will save your latest solution(s) entered "+"and submit it automatically.",prgLang:prgLangCount>1?"Once you start the test, you will be able to choose the programming "+"language here. If you switch to another "+"programming language in the middle of writing a solution, "+"your solution will disappear. If you, however, switch back "+"to the previous language, your solution will appear again.":"You will be solving this problem in "+prgLangName+".",editor:"Write the solution for the problem using the editor, "+"your solution should include the function as defined in "+"the task description. Your solution can include other "+"functions, procedures and methods.",solutionSaved:"Your solutions are being saved continuously, "+"however don't forget to submit your solution for "+"evaluation once you're done.",runButton:"Run your solution to see if it a) compiles, "+"b) returns a correct result given the exemplary "+"data from the task description, "+"c) terminates within an acceptable period of time."+" Running your solution will help you to avoid simple"+" mistakes. You can verify your solution multiple times."+' The number of "run" requests will not influence '+"your score. The output window can be increased.",testData:"You can run your solution on your test data to see "+"what results it computes, you will not be informed "+"about the correctness of this result. "+"You can add a maximum of 5 test cases at once.",outputWindow:"Compilation and verification output is visible here.",outputWindowResize:"The output window can be increased.",submitButton:taskCount>1?"Submit your solution for final evaluation. "+"This will close the task and you will not be able "+"to make any more changes. You don't have to submit your solution "+"before moving to another task but you need to submit each "+"task solution separately.":"This will end this session. You can submit your solution only once.",quitButton:"Quit will finish this session without sending "+"your solution for evaluation. You can re-open the "+"session, but quitting does not put the timer on hold.",exitOverlay:"Click anywhere to hide the help overlay."};function _buildSteps(){var steps=[];if(isInitial){steps.push({intro:self.stepsTexts.introduction})}steps.push({element:"#task_description",intro:self.stepsTexts.problemDescription,position:"right",numberPosition:"right"});if(taskCount>1){steps.push({element:".task-list",intro:self.stepsTexts.tasksTab})}steps=steps.concat([{element:"#clock",intro:self.stepsTexts.timer,position:"left",numberPosition:"bottom",padding:0},{element:"#prg_lang_list",intro:self.stepsTexts.prgLang,position:"left",numberPosition:"bottom"},{element:"#edit",intro:self.stepsTexts.editor,position:"left"},{element:"#save_status",intro:self.stepsTexts.solutionSaved,position:"top"},{element:"#verify_button",intro:self.stepsTexts.runButton,position:"top"},{element:"#console",intro:self.stepsTexts.outputWindow,position:"top"},{element:"#resize_console_button",intro:self.stepsTexts.outputWindowResize,position:"left"}]);if($("#add_test_case").is(":visible")){steps.push({element:"#add_test_case",intro:self.stepsTexts.testData,position:"top",numberPosition:"right"})}steps=steps.concat([{element:"#final_button",intro:self.stepsTexts.submitButton,position:"top"},{element:"#quit_button",intro:self.stepsTexts.quitButton,position:"left"},{intro:self.stepsTexts.exitOverlay}]);return steps}self.enableChat=function(chat){self.chat=chat};function _addSupportToStep(exitIntro){var introJs=this;var $stepElt=$(".introjs-tooltip");if($stepElt.find(".support").length>0)return;var $chatElt=$('<div class="support"></div>');if(self.chat){if(self.chat.available)$chatElt.html('<br>Problems? <a href="#">Chat with us</a>.');else $chatElt.html('<br>Problems? <a href="#">Email us</a>.');$chatElt.find("a").click(function(e){e.preventDefault();if(exitIntro&&typeof exitIntro=="boolean"){introJs.exit()}self.chat.activate()})}else if(self.support_email){$chatElt.html("<br>Problems? Email us at "+"<a href='mailto:"+self.support_email+"' target=_blank>"+self.support_email+"</a>.")}$stepElt.append($chatElt)}self.showHelp=function(onClose){var intro=introJs();intro.setOption("steps",_buildSteps());intro.setOption("disableInteraction",true);if(typeof onClose==="function"){intro.oncomplete(onClose);intro.onexit(onClose);intro.onafterchange(_addSupportToStep)}else{intro.onafterchange(function(){_addSupportToStep.call(this,true)})}intro.start();$("a.introjs-button").click(function(e){e.preventDefault()})};return self};function Editor(){var self={template:null};self._updateTaskDescriptionHeight=function(h){$("#task_description").css({height:h+"px"})};self._updateEditorHeight=function(h){$("#solution").css({minHeight:h});$("#solution").css({height:h})};self.updatePageLayout=function(){var wh=$(window).outerHeight();$("#page").css({height:wh+"px"});var right_h=$("#rightColumn > div").outerHeight();var right_under_h=$("#rightColumn .under-edit").outerHeight();var editor_h=right_h-right_under_h;var left_h=$("#task > div").outerHeight();var left_under_h=$("#task .under-task").outerHeight();var task_descr_h=left_h-left_under_h;self._updateEditorHeight(editor_h);self._updateTaskDescriptionHeight(task_descr_h)};self.getValue=function(){return $("#solution").val()};self.setValue=function(value){$("#solution").val(value)};self.setTemplate=function(template){self.template=template};self.setPrgLang=function(prg_lang){};self.setEditable=function(editable){};self.clearHistory=function(){};self.onCopyEvent=function(f){};self.onPasteEvent=function(f){};self.onChangeEvent=function(f){$("#solution").on("change",f)};self.setNoNewLines=function(){};self.setReadOnlyRegions=function(){};self.enforceReadOnlyRegions=function(){};return self}function AceEditor(){var self=Editor();try{$("#solution").after('<pre class="ace" display="none"></pre>');self.ace=ace.edit($(".ace").get(0));$("#solution").hide();$(".ace").show()}catch(err){Log.error("Candidate interface","Error setting up Ace",err);window.alert("The rich code editor failed to load.\n"+"Please try reloading or use another browser.\n"+"\n"+"If you continue to have problems, please contact support@codility.com.");return self}ace.require("ace/ext/language_tools");self.ace.setShowPrintMargin(false);self.ace.setOptions({enableBasicAutocompletion:true});self.ace.setBehavioursEnabled(false);self.ace.commands.removeCommands(["foldOther","foldall"]);var session=self.ace.getSession();session.setTabSize(4);session.setUseSoftTabs(true);session.setUseWrapMode(true);self.Range=ace.require("ace/range").Range;self.Anchor=ace.require("ace/anchor").Anchor;self.HashHandler=ace.require("ace/keyboard/hash_handler").HashHandler;self.diffengine=ace.require("diffengine").DiffEngine(self);self.diffengine.enable(true);self._updateEditorHeight=function(h){$(".ace").css({minHeight:h});$(".ace").css({height:h});self.ace.resize()};self._clean=function(){self.ace.replaceAll("-",{needle:"−"})};self.getValue=function(){self._clean();return self.ace.getValue()};self.setValue=function(value){self.ace.getSession().setValue(value);self.ace.clearSelection();if(self.handleChange)self.handleChange()};self._prgLangToEditorMode=function(prg_lang){var lang_dict={c:"c_cpp",cpp:"c_cpp",cs:"csharp",java:"java",js:"javascript",lua:"lua",m:"objectivec",py:"python",pas:"pascal",php:"php",pl:"perl",rb:"ruby",scala:"scala",sql:"sql",vb:"vbscript",go:"golang"};return lang_dict[prg_lang]||"plain_text"};self.setPrgLang=function(prg_lang){var mode="ace/mode/"+self._prgLangToEditorMode(prg_lang);if(prg_lang=="php")self.ace.getSession().setMode({path:mode,inline:true});else self.ace.getSession().setMode({path:mode})};self.setEditable=function(editable){self.ace.setReadOnly(!editable)};self.clearHistory=function(){self.ace.getSession().setUndoManager(new ace.UndoManager)};self.onCopyEvent=function(f){self.ace.on("copy",f)};self.paste_handlers=[];self.onPasteEvent=function(f){if(typeof f==="function"){self.paste_handlers.push(f)}};self.ace.on("paste",function(event){event.text=event.text.replace(//g,"");for(var i=0;i<self.paste_handlers.length;i++){self.paste_handlers[i](event)}});self.onChangeEvent=function(f){self.handleChange=f;self.ace.on("change",f)};self.markers=[];self.readOnlyRanges=[];self.noNewLines=false;self.setReadOnlyRegions=function(regions){$.each(regions,function(index,value){if(value.start){var start=value.start;var end={};if(!value.end){end.row=start.row;end.column=self.ace.getSession().getDocument().getLine(start.row).length}else{end=value.end}var doc=self.ace.getSession().getDocument();var start_anchor=new self.Anchor(doc,start.row,start.column);start_anchor.setPosition(start.row,start.column,true);var end_anchor=new self.Anchor(doc,end.row,end.column);end_anchor.setPosition(end.row,end.column,true);self.readOnlyRanges.push({start:start_anchor,end:end_anchor})}})};self.setNoNewLines=function(bool){self.noNewLines=Boolean(bool);if(self.noNewLines){self.ace.keyBinding.addKeyboardHandler(self.keyHandlers.enterHandler)}else{self.ace.keyBinding.removeKeyboardHandler(self.keyHandlers.enterHandler)}};self.keyHandlers={enterHandler:new self.HashHandler([{name:"return",bindKey:"Return|Shift-Return",descr:"Always block Return",exec:function(ed){return false}}])};self.enforceReadOnlyRegions=function(e){var command=e.command;var contains=false;var multiLineSelect=false;if(self.readOnlyRanges){$.each(self.readOnlyRanges,function(index,val){contains=self.inRange(val);if(contains){return false}})}if(self.noNewLines){multiLineSelect=self.ace.getSession().getSelection().isMultiLine()}if(contains||multiLineSelect){if(!command.readOnly){e.preventDefault();e.stopPropagation();Console.msg_error("Your current selection includes portions that are readonly")}}else if(self.noNewLines){var currentCursor=self.ace.getCursorPosition();var rightEdge=currentCursor.column==self.ace.getSession().getLine(currentCursor.row).length;var leftEdge=currentCursor.column===0;var stop=self.isPrevented(command)||self.isReturn(command)||self.isDelete(command)&&rightEdge||self.isBackspace(command)&&leftEdge;if(stop){e.preventDefault();e.stopPropagation();Console.msg_error("You are not allowed to add or remove whole lines in this task")}}};self.inRange=function(range){var sel=self.ace.getSession().getSelection().getRange();var start=range.start;var end=range.end;range=new self.Range(start.row,start.column,end.row,end.column);return range.intersects(sel)};self.isDelete=function(command){return command.name in{del:true,removetolineend:true,removewordright:true}};self.isBackspace=function(command){return command.name in{backspace:true,"cut-or-delete":true,removetolinestart:true,removewordleft:true}};self.isReturn=function(command){return command.name in{"return":true}};self.isPrevented=function(command){return command.name in{cut:true,removeline:true,duplicateSelection:true,copylinesup:true,copylinesdown:true,movelinesup:true,movelinesdown:true,splitline:true}};self.ace.commands.on("exec",self.enforceReadOnlyRegions);return self}var MAX_SUBMIT_SOLUTION_RETRY_COUNT=15;var OLD_AUTOSAVE_PERIOD=2*60*1e3;var CHECK_AUTOSAVE_PERIOD=1e3;var AUTOSAVE_AFTER_EDIT_PERIOD=3*1e3;var AUTOSAVE_MIN_PERIOD=10*1e3;var AUTOSAVE_MAX_PERIOD=30*1e3;function CandidateUi(options){var self={options:options,task:{loaded:false,open:false,solution_template:null,name:null,type:null,prg_lang:null,human_lang:null,saved_solution:null,modified:false,last_modify_time:null,closed:false},trackers:[],resize_hnd:null,last_autosave_time:null,plugins:[],pastes_detected:0};self.updatePageLayout=function(){self.editor.updatePageLayout()};self.setupResizeEvent=function(){$(window).resize(function(){Log.debug("candidate window.resize event");if(self.resize_hnd!==null)clearTimeout(self.resize_hnd);self.resize_hnd=setTimeout(function(){self.updatePageLayout()},500)})};self.notifyCheckerTimeoutAction=function(){Log.debug("candidate action timeout","task="+self.task.name+" prg_lang="+self.task.prg_lang);Log.flush();$.ajax({type:"POST",url:self.options.urls["timeout_action"],data:{ticket:self.options.ticket_id,task:self.task.name,prg_lang:self.task.prg_lang,solution:self.editor.getValue()},dataType:"xml"})};self.actionTimeout=function(already_closed){if(!self.closed){self.closed=true;if(!already_closed){self.notifyCheckerTimeoutAction()}}if(!$("#msg_final_task_completed").is(":visible")&&!$("#msg_timeout").is(":visible")){$("#msg_timeout").jqmShow()}};self.openTask=function(){self.task.open=true;self.updateControls()};self.closeTask=function(){self.task.open=false;self.updateControls()};self.updateSaveStatus=function(text){$("#save_status").text(text)};self.updateModified=function(){if(self.task.open&&self.editor.getValue()!=self.task.saved_solution){self.task.last_modify_time=(new Date).getTime();self.task.modified=true;if(self.options.save_often)self.updateSaveStatus("")}else{self.task.modified=false;self.task.last_modify_time=null;if(self.options.save_often)self.updateSaveStatus("All changes saved.")}};self.isCalling=function(){return!!self.call};self.startCall=function(owner,xhr,data){self.call={owner:owner,xhr:xhr,timestamp:Date.now()};$.extend(self.call,data||{});self.updateControls()};self.callDetails=function(){if(!self.call)return"No call";else{var details="call: (owner="+self.call.owner+" duration="+(Date.now()-self.call.timestamp)+"ms"+" attempt="+(self.call.attempt?self.call.attempt:"1")+")";return details}};self.clearCall=function(){self.call=null;self.updateControls()};self.submitSolution=function(mode,analyzeStatus,successCallback,errorCallback,extraData,async){if(analyzeStatus&&async){Log.error("submitSolution: asynchronous calls with analyzeStatus are not supported");async=false}Log.info("candidate submit solution","mode="+mode+", task="+self.task.name+", lang="+self.task.prg_lang);Log.flush();if(!async&&self.isCalling()){Log.error("Trying to call submitSolution while still handling a call.");if(errorCallback)errorCallback();return}var url;if(mode=="verify"||mode=="final"||mode=="save"){url=self.options.urls[mode]}else{Log.error("candidate submit solution","unknown mode");if(errorCallback)errorCallback();return}var solution=self.editor.getValue();var task_name=self.task.name;var prg_lang=self.task.prg_lang;var data={ticket:self.options.ticket_id,task:task_name,prg_lang:prg_lang,solution:solution,trackers:self.getTrackersValue()};if(extraData!==undefined){$.each(extraData,function(k,v){data[k]=v})}if(mode=="verify"){TestCases.clean();var test_list=TestCases.get_list();test_list=$.grep(test_list,function(t){return t!==""});for(var i=0;i<test_list.length;i++){var id="test_data"+(i+1);var value=test_list[i];data[id]=value}}Log.debug("candidate submit solution","ajax started, url="+url);var xhr=$.ajax({url:url,data:data,type:"POST",error:function(){if(!async)self.clearCall();if(errorCallback)errorCallback()},success:function(data){Log.debug("candidate submit  solution","ajax succeed");$.each(self.trackers,function(i,t){t.reset()});var result=xmlNodeValue(data,"response result");if(result=="OK"||result=="LATER"){if(self.task.loaded&&self.task.name==task_name&&self.task.prg_lang==prg_lang){self.task.saved_solution=solution;self.updateModified()}else{Log.warning("submit returned after switching away from task")}}if(analyzeStatus){Log.debug("candidate submit solution","analyzing status");self.submitSolutionStatusReceived(data,successCallback,errorCallback)}else{Log.debug("candidate submit solution","not analyzing status");if(!async)self.clearCall();successCallback(data)}}});if(!async)self.startCall("submitSolution("+mode+")",xhr,{attempt:0});self.updateControls()};self.updateControls=function(){var may_edit=self.task.loaded&&self.task.open;var may_submit_or_reload=self.task.loaded&&self.task.open&&!self.isCalling();var may_switch=self.task.loaded&&!self.isCalling();var submit_or_reload_controls=["#verify_button","#final_button","#save_btn","#current_human_lang","#current_prg_lang","#reset_btn"];var switch_controls=["#quit_button"];self.editor.setEditable(may_edit);$(submit_or_reload_controls).each(function(i,id){$(id).prop("disabled",!may_submit_or_reload)});$(switch_controls).each(function(i,id){$(id).prop("disabled",!may_switch)});$(".task-list").toggleClass("disabled",!may_switch);if(self.task.type=="bugfixing")$("#reset_btn").show();else $("#reset_btn").hide();if(self.options.sequential)$(".task-list").addClass("disabled")};self.submitSolutionStatusReceived=function(data,successCallback,errorCallback){Log.debug("candidate submit solution status received");if(self.call===null)return;var id=xmlNodeValue(data,"response id");var result=xmlNodeValue(data,"response result");var message=xmlNodeValue(data,"response message");if(result=="LATER"){var attempt=self.call.attempt;Log.debug("candidate submit solution status received","result LATER");if(attempt<MAX_SUBMIT_SOLUTION_RETRY_COUNT){if(attempt==5)Console.add_loader_comment("Still working, please wait...");setTimeout(function(){Log.debug("candidate submitSolutionRecheckStatus","timeout succeeded");self.recheckSolutionStatus(attempt+1,id,successCallback,errorCallback)},(attempt+1)*1e3)}else{Log.error("candidate submitSolution error","too many retries");self.clearCall();errorCallback($.parseXML("<message>Sorry, verification timed out. Please try again, and reduce the number of test cases if you have any.</message>"))}}else{self.clearCall();Log.handle(result=="ERROR"?"ERROR":"INFO","candidate submit solution status received","result "+result+" "+message);if(result=="OK")successCallback(data);else errorCallback(data)}};self.recheckSolutionStatus=function(attempt,id,successCallback,errorCallback){Log.debug("candidate recheckSolutionStatus");var data={ticket:self.options.ticket_id,id:id};var url=self.options.urls["status"];Log.debug("candidate recheckSolutionStatus","ajax started, url="+url+" attempt="+attempt);var xhr=$.ajax({url:url,data:data,type:"POST",error:[self.clearCall,errorCallback],success:function(data){Log.debug("candidate recheckSolutionStatus","ajax succeeded");self.submitSolutionStatusReceived(data,successCallback,errorCallback)}});self.startCall("recheckSolution",xhr,{attempt:attempt})};self.verifyAction=function(){Console.clear();Console.msg("Running solution...");Console.add_loader("Running solution...");Log.info("candidate verify action");self.submitSolution("verify",true,self.verifyActionSuccess,self.verifyActionError)};self.verifyActionSuccess=function(xml){Console.remove_loader();var verification_ok=false;var _message=xmlNodeValue(xml,"response > message");var _html=xmlNodeValue(xml,"response > html");if(_message){Console.msg(_message)}else if(_html){Console.addHtml(_html);if(self.bugfixingNothingChanged()){var warning="You haven't changed anything in the initial solution. "+"It contains a bug, and we ask you to fix it.";$("#console .summary").replaceWith($('<div class="title summary error">').text(warning))}}var quote=xmlNodeValue(xml,"quote");Console.msg_quote(quote);self.editor.updatePageLayout()};self.verifyActionError=function(xml){Console.remove_loader();var _message="";if(xml!==null){_message=xmlNodeValue(xml,"message")}Log.warning("verification action error","message:"+_message);if(_message){Console.msg_syserr("Error : "+_message)}else{Console.msg_syserr("Connection problem. Please check your Internet connection and try again.")
}};self.saveAction=function(force,onSuccess,onError,extraData,async){if(!self.task.loaded){Log.debug("saveAction","task not loaded properly, not saving");return}var solution=self.editor.getValue();var prg_lang=self.task.prg_lang;if(!force){if(!self.task.modified){Log.debug("candidate skipping save solution action","no changes detected since last save");if(onSuccess){onSuccess()}return}}self.submitSolution("save",false,function(){Log.debug("candidate save action"+async?" async":"","success");if(onSuccess)onSuccess()},function(){Log.warning("candidate save action"+async?" async":"","error");if(onError)onError()},extraData,async)};self.saveActionSuccess=function(){Log.debug("candidate save action","success")};self.saveActionAsync=function(force,onSuccess,onError,extraData){self.saveAction(force,onSuccess,onError,extraData,true)};self.bugfixingNothingChanged=function(){if(self.task.type!=="bugfixing"||self.editor.template===null)return false;var diff=null;try{diff=Diff.analyze(self.editor.template,self.editor.getValue())}catch(err){Log.error("Error computing diff",err)}return diff&&diff.nChanged===0};self.finalSubmitButtonAction=function(){if(self.bugfixingNothingChanged()){$("#bugfix_no_changes").jqmShow()}else{$("#final_prompt").jqmShow()}};self.finalSubmitAction=function(){Console.clear();self.finalSubmitActionVerify()};self.finalSubmitActionError=function(xml){Clock.timeout_temp_disabled=false;var _message=xml!==null?xmlNodeValue(xml,"message"):null;$("#final_verification .message").html("<b>ERROR</b><br> The final submission failed, try again?"+(_message?"<br>\n"+_message:""));$("#fv_loader").css({display:"none"});$("#final_verification .dialog_buttons").css({display:"block"});Log.warning("candidate final submission failed","message: "+_message);Console.msg_syserr("Connection problem. Please check your Internet connection and try again.")};self.finalSubmitActionVerify=function(){Log.info("candidate final submit verification");$("#final_prompt").jqmHide();$("#final_verification .dialog_buttons").hide();$("#final_verification .message").html("<b>Codility is verifying your solution.</b><br><br>");$("#fv_loader").css({display:"block"});$("#final_verification").jqmShow();self.submitSolution("verify",true,self.finalSubmitActionVerifySuccess,self.finalSubmitActionError)};self.finalSubmitActionVerifySuccess=function(xml){$("#fv_loader").css({display:"none"});var _message=xmlNodeValue(xml,"response > message");var _html=xmlNodeValue(xml,"response > html");var _compile_ok=xmlNodeValue(xml,"response > compile_ok");var _tests_ok=xmlNodeValue(xml,"response > tests_ok");if(_compile_ok=="1"&&_tests_ok=="1"){Log.info("candidate final submit verify","solution passed example tests");self.finalSubmitActionSave(1)}else{Log.info("candidate final submit verify","solution didn't pass example tests");if(_html)_message=_html;var $message=$("#final_verification .message");$message.html("<b>ERROR</b><br> Ooops, we found some errors.<br>"+"Your solution is not correct, do you still want to submit it?<br>");if(_message){var $details=$('<div style="width:80%;text-align:left;margin-left:10%;margin-right:10%;margin-top:10px;">'+"<small><b>evaluation details:</b></small><br>"+'<div class="verify-details"></div>'+"</div>");$details.find(".verify-details").html(_message);$message.append($details)}$("#final_verification .dialog_buttons").css({display:"block"})}};self.finalSubmitActionSave=function(is_ok){Log.debug("candidate final submit action save");var ver_res;if(is_ok){ver_res="OK!"}else{ver_res="ERROR!"}$("#final_verification .dialog_buttons").css({display:"none"});$("#final_verification .message").html("<b>solution verification -- "+ver_res+"</b><br>"+"Your solution is being received and evaluated by our servers.");$("#fv_loader").css({display:"block"});Clock.timeout_temp_disabled=true;setTimeout(function(){self.submitSolution("final",false,self.finalSubmitActionSaveSuccess,self.finalSubmitActionError)},1e3)};self.finalSubmitActionSaveSuccess=function(data){Log.debug("candidate final submit action save success");self.next_task=xmlNodeValue(data,"response next_task");setTimeout(function(){$("#final_verification").jqmHide();self.finalSubmitActionComplete()},500)};self.finalSubmitActionComplete=function(){Log.debug("candidate final submit action complete");self.closeTask();if(self.next_task!==""){$("#msg_task_completed").jqmShow()}else{self.closed=true;$("#msg_final_task_completed").jqmShow()}Clock.timeout_temp_disabled=false};self.finalSubmitForceAction=function(){self.finalSubmitActionSave(0)};self.oldAutoSave=function(){setTimeout(self.oldAutoSave,OLD_AUTOSAVE_PERIOD);if(!self.isCalling())self.saveActionAsync()};self.checkAutoSave=function(){setTimeout(self.checkAutoSave,CHECK_AUTOSAVE_PERIOD);if(!self.task.modified)return;if(self.isCalling())return;var now=(new Date).getTime();if(self.last_autosave_time&&now-self.last_autosave_time<AUTOSAVE_MIN_PERIOD)return;if(now-self.task.last_modify_time>=AUTOSAVE_AFTER_EDIT_PERIOD||self.last_autosave_time&&now-self.last_autosave_time>=AUTOSAVE_MAX_PERIOD){self.last_autosave_time=now;self.saveActionAsync()}};self.reloadTask=function(prefer_server_prg_lang){self.task.loaded=false;self.task.solution_template=null;self.task.type=null;self.editor.setTemplate(null);var task=$(".task-list").data("value");var prg_lang=$("#current_prg_lang").val()||self.options.current_prg_lang;var human_lang=$("#current_human_lang").val()||self.options.current_human_lang;Log.info("candidate reload task","task="+task+", prg_lang="+prg_lang+", human_lang"+human_lang);$("#task_description").html("Loading task description...");self.editor.setPrgLang(null);self.editor.setValue("Loading solution...");self.editor.clearHistory();$("#example_input").val("");var url=self.options.urls["get_task"];var data={ticket:self.options.ticket_id,task:task,human_lang:human_lang,prg_lang:prg_lang,prefer_server_prg_lang:!!prefer_server_prg_lang};Log.debug("candidate reload task","ajax start, url="+url);var xhr=$.ajax({url:url,data:data,type:"POST",error:self.reloadTaskError,success:function(data){self.reloadTaskSuccess(data,task)}}).always(self.clearCall);self.startCall("reloadTask",xhr);self.updateControls()};self.nextTask=function(){Log.info("candidate next task","next task="+self.next_task);self.setCurrentTask(self.next_task);TestCases.disable();self.reloadTask(true)};self.validSelectableNode=function(t){var t_nodename=t.prop("nodeName");if(t_nodename=="TEXTAREA")return true;if(t_nodename=="TT"||t_nodename=="SPAN"&&t.hasClass("number")){return true}else{return false}};self.selectionRestrictedToConsole=function(){var commonAncestor=$(window.getSelection().getRangeAt(0).commonAncestorContainer);if(commonAncestor.closest("#console").length){return true}return false};self.validCopySelection=function(e){if(typeof window.getSelection=="undefined"){return false}if(self.selectionRestrictedToConsole())return true;var t=$(e.target);if(!self.validSelectableNode(t))return false;var selection=window.getSelection();var range=selection.getRangeAt(0);var sobj=$("<div></div>").append(range.cloneContents());if(sobj.html().search("<")!=-1){return false}return true};self.simpleCopyProtection=function(){Log.debug("protecting task description");$("#brinza-task-description").addClass("protected");if(typeof window.getSelection=="undefined"){$("#brinza-task-description > *").each(function(){$(this).attr("unselectable","on")});if($("#t_overlay").length===0){$("#brinza-task-description").css({position:"relative"});$("#brinza-task-description").prepend('<div id="t_overlay" class="transparent"></div>')}}else{$("body").off("copy");$("body").on("copy",function(e){if(self.validCopySelection(e)){return}else{e.preventDefault()}})}};self.reloadTaskSuccess=function(data,task){var prg_langs=self.options.prg_langs;Log.debug("candidate reload task success");var task_status=xmlNodeValue(data,"response task_status");var task_description=xmlNodeValue(data,"response task_description");var task_type=xmlNodeValue(data,"response task_type");var solution_template=xmlNodeValue(data,"response solution_template");var current_solution=xmlNodeValue(data,"response current_solution");var example_input=xmlNodeValue(data,"response example_input");var prg_lang=xmlNodeValue(data,"response prg_lang");var human_lang=xmlNodeValue(data,"response human_lang");var human_lang_list=JSON.parse(xmlNodeValue(data,"response human_lang_list"));var allow_user_test_cases=JSON.parse(xmlNodeValue(data,"response allow_user_test_cases"));var allow_modal_editor=JSON.parse(xmlNodeValue(data,"response allow_modal_editor")||"false");var modal_editor_options=JSON.parse(xmlNodeValue(data,"response modal_editor_options")||"{}");self.current_prg_lang_list=JSON.parse(xmlNodeValue(data,"response prg_lang_list"));self.task.name=task;self.task.type=task_type;self.task.solution_template=solution_template;self.task.prg_lang=prg_lang;self.task.human_lang=human_lang;self.task.saved_solution=current_solution;self.task.allow_user_test_cases=allow_user_test_cases;$("#task_description").html(task_description);if(!self.options.demo&&!self.options.cert)self.simpleCopyProtection();$("#current_prg_lang").val(prg_lang);var lang_ver=prg_langs[prg_lang].version;$("#prg_lang_ver").text(lang_ver);$("#current_human_lang option").remove();$.each(human_lang_list,function(i,hl){var name=self.options.human_langs[hl].name_in_itself;var $option=$("<option>").attr("value",hl).text(name);$("#current_human_lang").append($option)});$("#current_human_lang").val(human_lang);$("#current_prg_lang option").remove();$.each(self.current_prg_lang_list,function(i,pl){var name=self.options.prg_langs[pl].name;var $option=$("<option>").attr("value",pl).text(name);$("#current_prg_lang").append($option)});$("#current_prg_lang").val(prg_lang);if(!$.inArray(human_lang,human_lang_list))$("#current_human_lang option:first").attr("selected",true);self.editor.setPrgLang(prg_lang);self.editor.setNoNewLines(false);if(self.task.type=="bugfixing"){self.editor.setTemplate(self.task.solution_template);self.editor.setNoNewLines(true)}self.editor.setValue(current_solution);self.editor.clearHistory();$("#example_input").val(example_input);var show_test_cases=task_status=="open"&&allow_user_test_cases;if(task_status=="open"){self.openTask()}else if(task_status=="closed"){self.closeTask();$("#msg_task_closed").jqmShow()}else{Log.error("candidate reload task success","unknown task_status "+task_status)}self.task.loaded=true;if(show_test_cases){TestCases.enable();if(allow_modal_editor){TestCases.enable_modal_editor(modal_editor_options)}else{TestCases.disable_modal_editor()}}else{TestCases.disable()}self.updateControls()};self.changePrgLangAction=function(){self.saveAction(false,self.reloadTask,function(){Console.msg_syserr("Could not change language");$("#current_prg_lang").val(self.task.lang)})};self.reloadTaskError=function(){Console.msg_syserr("Could not load task");$("#task_description").html("Could not load task description");self.editor.setPrgLang(null);self.editor.setValue("Could not load solution. Please refresh the page in the browser.");self.editor.clearHistory();$("#example_input").val("")};self.changeTaskActionError=function(){Console.msg_syserr("Could not change task");self.setCurrentTask(self.task.name)};self.changeTaskAction=function(){self.saveAction(false,function(){self.reloadTask(true)},self.changeTaskActionError);TestCases.disable()};self.changeHumanLangAction=function(){self.saveAction(false,self.reloadTask,self.changeHumanLangError)};self.changeHumanLangError=function(){Console.msg_syserr("Could not change human language")};self.resetAction=function(){self.saveActionAsync();self.editor.setValue(self.task.solution_template)};self.actionLogout=function(mode){Log.info("candidate action logout");Clock.active=false;self.exit(self.options.urls["close"]+"?"+mode+"=1")};self.exit=function(url){window.location.href=url};self.quitAction=function(){Log.info("candidate quit action");self.saveActionAsync();$("#quit_prompt").jqmShow();$("#q_yes").click(function(){$("#quit_prompt").jqmHide();self.actionLogout("resign")});return true};self.resizeConsoleAction=function(){$("#console").toggleClass("maximized");if($("#console").hasClass("maximized")){$("#resize_console_button").val("↓")}else{$("#resize_console_button").val("↑")}self.updatePageLayout()};self.setupEditor=function(){self.editor=AceEditor();self.editor.onChangeEvent(self.updateModified)};self.setupModals=function(){if(self.options.train){$(".in-train").show();$(".in-default").hide();$(".no-train").hide()}else if(self.options.demo){$(".in-demo").show();$(".in-default").hide()}$("#quit_prompt").jqm({modal:true});$("#final_prompt").jqm({modal:true});$("#final_verification").jqm({modal:true});$("#msg_task_completed").jqm({modal:true});$("#msg_task_closed").jqm({modal:true});$("#bugfix_no_changes").jqm({modal:true});$("#exit_initial_help").jqm({modal:true});$("#keyboard_help").jqm({modal:false});function surveyPopup($elt,logout_reason){if(self.options.show_survey){$elt.find(".no-survey-continue").hide();$elt.find(".survey-msg").show()}$elt.jqm({modal:true,onShow:function(hash){if(self.options.show_survey){Clock.active=false;surveyShow(hash.w)}hash.w.show()},onHide:function(hash){if(self.options.show_survey&&surveyFilled()){surveySubmit(self.options.urls["submit_survey"],function(){self.actionLogout(logout_reason)})}else{self.actionLogout(logout_reason)}}})}surveyPopup($("#msg_final_task_completed"),"final_task_completed");surveyPopup($("#msg_timeout"),"timeout")};self.setupButtons=function(){$("#quit_button").click(self.quitAction);$("#final_button").click(self.finalSubmitButtonAction);$("#next_task_button").click(function(){$("#msg_task_completed").jqmHide();self.nextTask()});$("#exit_intro_yes").click(function(){$("#exit_initial_help").jqmHide();self.startTicket()});$("#exit_intro_no").click(self.initialHelp);$("#fp_yes").click(self.finalSubmitAction);$("#fv_yes").click(self.finalSubmitForceAction);$("#current_prg_lang").change(self.changePrgLangAction);if(!self.options.sequential)$(".task-list").on("click",".task:not(.inactive)",function(e){if($(".task-list").hasClass("disabled"))return;self.setCurrentTask($(e.target).data("name"));self.changeTaskAction()});$("#current_human_lang").change(self.changeHumanLangAction);$("#resize_console_button").click(self.resizeConsoleAction);$("#verify_button").click(self.verifyAction);$("#reset_btn").click(self.resetAction);$("#help_btn").click(function(){self.showHelp(false,null)});$("#survey_skip_button").click(function(){$("#survey").parent().jqmHide()});$("#survey_continue_button").click(function(){$("#survey .hidden_part").removeClass("hidden_part");$(".hide-for-survey").hide();$(this).hide();$("#survey_submit_button").show()});$("#survey_submit_button").click(function(){$("#survey").parent().jqmHide()});$(".show-keyboard-help").click(function(){$("#keyboard_help").jqmShow()});if(window.navigator.platform==="MacIntel"){$("#keyboard_help .mac").show();$("#keyboard_help .no-mac").hide()}else{$("#keyboard_help .mac").hide();$("#keyboard_help .no-mac").show()}};self.setupSelects=function(){var n_tasks=self.options.task_names.length;$.each(self.options.task_names,function(i,task_name){var $option=$("<li>").addClass("task").data("name",task_name).text("Task "+(i+1));$(".task-list").append($option)});self.setCurrentTask(self.options.current_task_name);if(n_tasks>1){$(".current_task_select").show()}};self.setCurrentTask=function(name){$(".task-list").data("value",name);$(".task-list .task").each(function(){$(this).toggleClass("active",$(this).data("name")===name)})};self.getTrackersValue=function(){var res={};$.each(self.trackers,function(i,t){res[t.name]=JSON.stringify(t.exportData())});return res};self.setupTrackers=function(){var window_focus_tracker=new TimeTracker("focus",self.options.time_elapsed_sec);window_focus_tracker.turnOn();$(window).on("focus",function(){window_focus_tracker.turnOn()});$(window).on("blur",function(){window_focus_tracker.turnOff()});self.trackers.push(window_focus_tracker);var key_tracker=new TimeTracker("keypress",self.options.time_elapsed_sec);$("#edit").on("keypress",function(){key_tracker.tick()});self.trackers.push(key_tracker);function get_text(e){var text;if(typeof e==="string"){text=e}else if(typeof e.text==="string"){text=e.text}else{text=""}text=text.replace(/\r\n/g,"\n");return text}self.editor.onCopyEvent(function(e){self.editor.last_copy=get_text(e)});self.editor.onPasteEvent(function(e){var data=get_text(e.text);if(self.editor.last_copy===data)return;self.editor.last_paste=data;setTimeout(function(){var last_paste=$.trim(self.editor.last_paste);if(last_paste.split("\n").length<2)return;var solution=self.editor.getValue();var ppos=solution.indexOf(last_paste);var plen=last_paste.length;if(ppos==-1)return;self.pastes_detected++;self.saveActionAsync(true,null,null,{paste_start:ppos,paste_end:ppos+plen})},100)})};self.addPlugin=function(plugin){if(self.plugins.indexOf(plugin)!==-1){throw new Error("Trying to load previously loaded plugin")}plugin.load(self);self.plugins.push(plugin)};self.removePlugin=function(plugin){var index=self.plugins.indexOf(plugin);if(index===-1){throw new Error("Trying to unload not loaded plugin")}self.plugins.splice(index,1);plugin.unload()};self.removePlugins=function(){var plugins=self.plugins;self.plugins=[];plugins.forEach(function(plugin){try{plugin.unload()}catch(err){Log.error("Failed to unload plugin",err)}})};self.showHelp=function(isInitial,onClose){var task_count,prg_lang_name,prg_lang_count;task_count=self.options.task_names.length;if(self.current_prg_lang_list!==undefined){prg_lang_count=self.current_prg_lang_list.length;prg_lang_name=self.options.prg_langs[self.current_prg_lang_list[0]].name}else{prg_lang_count=2}var help=Help(isInitial,task_count,prg_lang_name,prg_lang_count,self.options.support_email);if(self.chat)help.enableChat(self.chat);help.showHelp(onClose)};self.startTicket=function(){var url=self.options.urls["start_ticket"];var data={ticket:self.options.ticket_id};var xhr=$.ajax({url:url,data:data,type:"POST",error:self.startTicketError,success:function(data){self.startTicketSuccess(data)}}).always(self.clearCall);self.startCall("startTicket",xhr)};self.startTicketSuccess=function(data){var error=xmlNodeValue(data,"error");if(data.redirect){window.location.href=data.redirect}else if(error){var err_diag=$("#ticket_start_error").jqm({modal:true});err_diag.find(".error-message").html(error);err_diag.jqmShow()}else{self.initTask()}};self.startTicketError=function(){Console.msg_syserr("Network error encountered while trying to start your test. "+"Try reloading this page.")};self.WELCOME_MESSAGE='This is <a href="https://github.com/codility/cui" target="_blank">CUI</a>.  '+"CUI is free software.  "+'See <a href="https://github.com/Codility/cui/blob/master/COPYING.LESSER" target="_blank">COPYING.LESSER</a> '+'and <a href="https://github.com/Codility/cui/blob/master/AUTHORS" target="_blank">AUTHORS</a> '+"for details.";self.initTask=function(){Clock.init(self.options.ticket_id,self.options.urls["clock"],self.options.time_remaining_sec,self.options.time_elapsed_sec);self.reloadTask();if(self.options.save_often)setTimeout(self.checkAutoSave,CHECK_AUTOSAVE_PERIOD);else setTimeout(self.oldAutoSave,OLD_AUTOSAVE_PERIOD);self.updateControls();if(self.options.show_welcome){Console.msg_ok(self.WELCOME_MESSAGE)}};self.initialHelp=function(){Clock.setTime(self.options.time_remaining_sec);self.updateSaveStatus("You will see save status here");setTimeout(function(){self.showHelp(true,function(current_step){$("#exit_initial_help").jqmShow()})},500)};self.init=function(){self.setupEditor();self.setupModals();self.setupButtons();self.setupSelects();if(!self.options.demo&&!self.options.cert)self.setupTrackers();TestCases.init();if(self.options.show_chat)self.chat=Chat(self.options.support_email);self.updatePageLayout();self.setupResizeEvent();if(self.options.show_help){if(self.options.show_help&&self.options.show_test_cases){TestCases.enable()}self.initialHelp()}else{self.startTicket()}};self.shutdown=function(){$(window).off("focus");$(window).off("blur");self.removePlugins()};self.data={};return self}var Clock={CLOCK_REFRESH_TIME:2*60*1e3,timeout_warning_active:false,time_to_end:null,active:true,timeout_temp_disabled:false,setTime:function(time_to_end){if(typeof time_to_end!=="number"){time_to_end=this.time_to_end}var seconds=time_to_end%60;var minutes=Math.floor(time_to_end/60)%60;var hours=Math.floor(time_to_end/(60*60));var time_string=hours<10?"0"+hours:hours;time_string+=":";time_string+=minutes<10?"0"+minutes:minutes;time_string+=":";time_string+=seconds<10?"0"+seconds:seconds;$("#clock").text(time_string)},init:function(ticket_id,url,time_remaining_sec,time_elapsed_sec){this.ticket_id=ticket_id;this.url=url;this.timeout_warning_active=false;this.time_from_start=time_elapsed_sec;this.time_to_end=time_remaining_sec;this.active=true;this.setTime();var that=this;setTimeout(function(){that.clock_tick()},1e3);this.refreshClock();window.onbeforeunload=function(e){if(Clock.active)return"Are you sure you want to close the window?\n"+"If you have finished, use the SUBMIT button.\n"+"If the interface is not responding (e.g. connection issues), it's acceptable to reload.";else return undefined}},clock_tick:function(){if(!Clock.active)return;this.time_to_end-=1;this.setTime();if(this.time_to_end==60||this.time_to_end==2*60||this.time_to_end==3*60){this.startTimeoutWarning(15)}if(this.time_to_end<=0){ui.actionTimeout()}else{var that=this;setTimeout(function(){that.clock_tick()},1e3)}},_update:function(data){var result=xmlNodeValue(data,"response result");if(result=="ERROR"){var t=String(xmlNodeValue(data,"response message"));if(t.match("closed")!==null){if(!this.timeout_temp_disabled){Log.info("Ticket closed by server");ui.actionTimeout(true)}}else{Log.error("Update clock error")}}else{var new_timelimit=parseInt(xmlNodeValue(data,"response new_timelimit"),10);var new_time_elapsed=parseInt(xmlNodeValue(data,"response new_time_elapsed"),10);var diff=xmlNodeValue(data,"response diff");Log.debug("candidate update clock","new_timelimit: "+new_timelimit+(diff!==""?" diff="+diff:""));if(new_timelimit>0){this.time_to_end=new_timelimit;this.time_from_start=new_time_elapsed}}},refreshClock:function(){var that=this;this.clockAction();setTimeout(function(){that.refreshClock()},this.CLOCK_REFRESH_TIME)},clockAction:function(){var that=this;Log.debug("candidate clock action");var data={ticket:this.ticket_id,old_timelimit:this.time_to_end};$.ajax({url:this.url,data:data,type:"POST",success:function(d){that._update(d)},timeout:30*1e3})},startTimeoutWarning:function(n){Log.info("candidate timeout warning showed");if(this.timeout_warning_active)return;this.timeout_warning_active=true;var clock_id="#clock";$(clock_id).fadeOut(100);$(clock_id).fadeOut(1,function(){$(clock_id).css({backgroundColor:"red"})});var i;for(i=0;i<n;i++){$(clock_id).fadeIn(250);$(clock_id).fadeOut(250)}$(clock_id).fadeIn(1,function(){$(clock_id).css({backgroundColor:""})});$(clock_id).fadeIn(100);var that=this;setTimeout(function(){that.timeout_warning_active=false},5e3)}};function TimeTracker(name,time_elapsed_sec){var self={name:name,start_time:(new Date).getTime()/1e3-time_elapsed_sec,interval:60,data:{},status:null,last_t:null};self.updateClock=function(new_time_elapsed_sec){self.start_time=(new Date).getTime()/1e3-new_time_elapsed_sec};self.reset=function(){self.data={};if(self.status!==null){self.last_t=self.current_t();self.updateStatus(self.status)}};self.tick=function(c){var t=self.current_t();if(!(t in self.data))self.data[t]=0;if(c===undefined)self.data[t]+=1;else self.data[t]+=c};self.updateStatus=function(new_status){var t=self.current_t();if(self.status!==null&&self.last_t!==null){for(var i=self.last_t+1;i<t;i++)self.data[i]=self.status}if(!(t in self.data)||new_status===1)self.data[t]=new_status;self.status=new_status;self.last_t=t};self.turnOn=function(){self.updateStatus(1)};self.turnOff=function(){self.updateStatus(0)};self.print=function(){if(self.status!==null)self.updateStatus(self.status);console.log("Tracker: "+self.name+" interval="+self.interval+" data="+JSON.stringify(self.data))};self.exportData=function(){if(self.status!==null)self.updateStatus(self.status);return[self.data,self.interval]};self.current_t=function(){var t=(new Date).getTime()/1e3-self.start_time;return Math.floor(t/self.interval)};self.data={};self.status=null;return self}function xml_to_string(xml_node){if(typeof xml_node=="undefined")return"";if(typeof xml_node.xml=="undefined")return"";else if(XMLSerializer){var xml_serializer=new XMLSerializer;return xml_serializer.serializeToString(xml_node)}else{return""}}function xmlNodeValue(xml,path){var result="";result=$(xml).find(path).text();return result}function getParams(query){if(query===undefined)query=window.location.search.substring(1);var match;var pl=/\+/g;var search=/([^&=]+)=?([^&]*)/g;var decode=function(s){return decodeURIComponent(s.replace(pl," "))};var params={};while(match=search.exec(query))params[decode(match[1])]=decode(match[2]);return params}function surveyShow(dialog_element){var survey_placeholder=$(".survey_placeholder",dialog_element);if(survey_placeholder.size()!==1){return}var survey=$("#survey");survey[0].parentNode.removeChild(survey[0]);survey_placeholder.replaceWith(survey);survey.show();if(survey.find(".hidden_part").length===0){$("#survey_continue_button").hide();$("#survey_submit_button").show()}}function surveyFilled(){var forms=$("#survey form");for(var i=0;i<forms.length;++i){var form=forms[i];var fields=$(form).serializeArray();for(var j=0;j<fields.length;++j){if(fields[j].value!=="")return true}}return false}function surveySubmit(url,callback){var payload=[];$("#survey form").each(function(_i,form){var survey_name=$(form).data("name");var form_data=$(form).serializeArray();var form_payload={survey_name:survey_name};for(var i=0;i<form_data.length;++i){form_payload[form_data[i].name]=form_data[i].value}payload.push(form_payload)});$.ajax({type:"POST",url:url,data:JSON.stringify(payload),timeout:1e3,complete:callback,contentType:"application/json"})}ace.define("diffengine",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],function(require,exports,module){"use strict";var LineWidgets=require("ace/line_widgets").LineWidgets;var dom=require("ace/lib/dom");var Range=require("ace/range").Range;var prev_row=null;exports.DiffEngine=function(editor,options){var self={};self.options=options;self.editor=editor;self.diff={};self.session=self.editor.ace.session;if(!self.session.widgetManager){self.session.widgetManager=new LineWidgets(self.session);self.session.widgetManager.attach(self.editor.ace)}self.enable=function(bool){if(bool){self.editor.ace.on("change",self.onDocumentChange);self.editor.ace.on("changeSelection",self.onSelectionChange)}else{self.editor.ace.off("change",self.onDocumentChange);self.editor.ace.off("changeSelection",self.onSelectionChange)}};self.markers=[];self.onDocumentChange=function(){var prev_unedited=!(prev_row in self.diff);self.diff=self._calculateDiff();var now_edited=prev_row in self.diff;if(prev_unedited&&now_edited){prev_row=null}if(self.markers.length){$.each(self.markers,function(idx,val){self.editor.ace.session.removeMarker(val)})}var diff_keys=Object.keys(self.diff);if(diff_keys.length){$.each(diff_keys,function(idx,line){var lineEnd=self.editor.ace.session.getLine(line).length;self.markers.push(self.editor.ace.session.addMarker(new Range(line,0,line,lineEnd),"highlight-changed-line","fullLine"))})}};self.onSelectionChange=function(){if(self.editor.ace.getSession().getSelection().isMultiLine()||!self.diff)return;var pos=self.editor.ace.getCursorPosition();var currentRow=pos.row;if(currentRow in self.diff&&prev_row!==currentRow){var oldWidget=self.session.lineWidgets&&self.session.lineWidgets[currentRow];if(oldWidget){oldWidget.destroy(true)}var widget=self._buildWidget(pos);if(widget){self.editor.ace.session.widgetManager.addLineWidget(widget)}}prev_row=currentRow};self._buildWidget=function(position){var row=position.row;var w=null;var className=self.options&&self.options.className;if(self.template_lines&&self.template_lines.length>row){w={row:row,fixedWidth:true,coverGutter:true,el:dom.createElement("div")};var el=w.el.appendChild(dom.createElement("div"));var arrow=w.el.appendChild(dom.createElement("div"));if(className){arrow.className="diff_widget_arrow "+className}else{arrow.className="diff_widget_arrow diff_widget_default"}var left=self.editor.ace.renderer.$cursorLayer.getPixelPosition({row:position.row,column:0}).left;arrow.style.left=left+self.editor.ace.renderer.gutterWidth-5+"px";w.el.className="diff_widget_wrapper";if(className){el.className="diff_widget "+className}else{el.className="diff_widget diff_widget_default"}el.innerHTML=self._renderTemplateLine(row);el.style.paddingLeft=self.editor.ace.renderer.gutterWidth+self.editor.ace.renderer.$padding+"px";w.destroy=function(ingoreMouse){if(self.editor.ace.$mouseHandler.isMousePressed&&!ingoreMouse)return;self.session.widgetManager.removeLineWidget(w);self.editor.ace.off("changeSelection",w.destroyOnExit);self.editor.ace.off("mouseup",w.destroyOnExit);self.editor.ace.off("changeSession",w.destroy);self.editor.ace.off("change",w.destroy);self.editor.ace.off("change",w.destroyOnUnedit)};w.destroyOnExit=function(){var pos=self.editor.ace.getCursorPosition();var currentRow=pos.row;if(w.row!=currentRow){w.destroy()}};w.destroyOnUnedit=function(){var pos=self.editor.ace.getCursorPosition();var currentRow=pos.row;if(!(currentRow in self.diff)){w.destroy()}};self.editor.ace.on("mouseup",w.destroyOnExit);self.editor.ace.on("changeSelection",w.destroyOnExit);self.editor.ace.on("changeSession",w.destroy);self.editor.ace.on("change",w.destroyOnExit);self.editor.ace.on("change",w.destroyOnUnedit)}return w};self._renderTemplateLine=function(row){var tokenizer=self.editor.ace.session.getMode().getTokenizer();var row_text=self.template_lines[row];var tokens=tokenizer.getLineTokens(row_text).tokens;var stringBuilder=[];if(tokens.length){var wrapLimit=self.editor.ace.session.getWrapLimit();var tabSize=self.editor.ace.session.getTabSize();var displayTokens=self.editor.ace.session.$getDisplayTokens(row_text);var splits=self.editor.ace.session.$computeWrapSplits(displayTokens,wrapLimit,tabSize);if(splits&&splits.length)self.editor.ace.renderer.$textLayer.$renderWrappedLine(stringBuilder,tokens,splits,false);else self.editor.ace.renderer.$textLayer.$renderSimpleLine(stringBuilder,tokens);stringBuilder.unshift("<div class='ace_line' style='height:",self.editor.ace.renderer.$textLayer.config.lineHeight,"px'>");stringBuilder.unshift("<div class='ace_line_group' style='height:",self.editor.ace.renderer.$textLayer.config.lineHeight*(splits.length+1),"px'>")}stringBuilder.push("</div>","</div>");return stringBuilder.join("")};self._calculateDiff=function(){var diff={};var template=self.editor.template;var value=self.editor.getValue();if(template){var template_lines=Diff.splitLines(template);var value_lines=Diff.splitLines(value);var linesLength=Math.max(template_lines.length,value_lines.length);for(var i=0;i<linesLength;i++){if(template_lines[i]!==value_lines[i]){diff[i]=true}}if(template!==self.template){self.template=template;self.template_lines=template_lines}}return diff};return self}});function Chat(support_email){var self={available:false,expanded:false,shown:false,support_email:support_email};self.init=function(){olark("api.chat.onOperatorsAvailable",function(){self.available=true});olark("api.chat.onOperatorsAway",function(){self.available=false});olark("api.box.onExpand",function(){self.expanded=true});olark("api.box.onShrink",function(){self.expanded=false});olark("api.box.onShow",function(){self.shown=true});olark("api.box.onHide",function(){self.shown=false});olark("api.visitor.updateCustomFields",{report_url:window.location.host+"/tickets/"+ui.options.ticket_id})};self.waitUntilReady=function(onReady,onFailure){var n_tries=15,interval=300;
function poll(){if(self.shown&&self.expanded)onReady();else if(n_tries-->0)setTimeout(poll,interval);else onFailure()}poll()};self.pulse=function(){$("#habla_window_div").animate({transform:"scale(1.2)"},200).animate({transform:"scale(1)"},200)};self.fail=function(err){Console.msg_error("Sorry, loading the chat failed.<br>"+"If you require assistance, please contact "+"<a href='mailto:"+self.support_email+"' target=_blank>"+self.support_email+"</a>.");Log.error("couldn't load candidate chat",err)};self.activate=function(){if(!self.shown)olark("api.box.show");if(!self.expanded)olark("api.box.expand");self.waitUntilReady(self.pulse,self.fail)};self.init();return self}var Trees=function(){var Trees={};var TOKEN_TYPES=[{regex:/^\(/},{regex:/^\)/},{regex:/^,/},{regex:/^None/},{regex:/^[+-]?(0|[1-9]\d{0,9})/,convert:function(s){return parseInt(s,10)}}];Trees.tokenize=function(input){var tokens=[];while(input!==""){input=input.replace(/^\s+/,"");if(input==="")break;var token=null;for(var i=0;i<TOKEN_TYPES.length;i++){var m=TOKEN_TYPES[i].regex.exec(input);if(m){input=input.substr(m[0].length);token=m[0];if(TOKEN_TYPES[i].convert){token=TOKEN_TYPES[i].convert(token)}break}}if(token===null){var s=input;if(s.length>10)s=s.substr(0,10)+"...";throw new Error("unexpected input near '"+s+"'")}tokens.push(token)}return tokens};Trees.Parser=function(input){var self={};self.tokens=Trees.tokenize(input);self.is_empty=function(){return self.tokens.length===0};self.read_tree=function(){if(self.tokens.length===0)self.error_parsing("tree");if(self.tokens[0]==="None"){self.read("None");return{empty:true}}else if(self.tokens[0]==="("){self.read("(");var val=self.read_int();self.read(",");var l=self.read_tree();self.read(",");var r=self.read_tree();self.read(")");return{val:val,l:l,r:r}}else{self.error_parsing("tree")}};self.read_int=function(){if(self.tokens.length===0||typeof self.tokens[0]!=="number")self.error_parsing("integer");return self.tokens.shift()};self.read=function(expected_token){if(self.tokens.length===0||self.tokens[0]!==expected_token)self.error_parsing("'"+expected_token+"'");return self.tokens.shift()};self.end=function(){if(self.tokens.length>0)self.error_parsing("end of input")};self.error_parsing=function(what){throw new Error("unexpected "+(self.tokens.length>0?"'"+self.tokens[0]+"'":"end of input")+", required "+what)};return self};Trees.parse_tree=function(input){var parser=Trees.Parser(input);if(parser.is_empty())return{empty:true};var t=parser.read_tree();parser.end();return t};Trees.parse_tuple=function(input,format){var parser=Trees.Parser(input);var result={};var use_parens=format.length!=1;if(use_parens)parser.read("(");for(var i=0;i<format.length;i++){if(i>0)parser.read(",");var val;if(format[i].type=="tree")val=parser.read_tree();else if(format[i].type=="int")val=parser.read_int();else throw new Error("unrecognized type: "+format[i].type);result[format[i].name]=val}if(use_parens)parser.read(")");parser.end();return result};Trees.serialize_tree=function(tree){if(tree.empty)return"None";else return"("+tree.val+", "+Trees.serialize_tree(tree.l)+", "+Trees.serialize_tree(tree.r)+")"};Trees.serialize_tuple=function(tuple,format){var result=[];for(var i=0;i<format.length;i++){var data=tuple[format[i].name];var str;if(format[i].type=="tree")str=Trees.serialize_tree(data);else if(format[i].type=="int")str=data.toString();else throw new Error("unrecognized type: "+format[i].type);result.push(str)}if(format.length==1)return result[0];return"("+result.join(", ")+")"};return Trees}();var SVG=function(){var self={};var svgNS="http://www.w3.org/2000/svg";self.create=function(name,attributes,content){var elt=document.createElementNS(svgNS,name);self.update(elt,attributes,content);return elt};self.add=function(container,name,attributes,content){var elt=self.create(name,attributes,content);container.appendChild(elt);return elt};self.clear=function(container){while(container.firstChild){container.removeChild(container.firstChild)}};self.update=function(elt,attributes,content){for(var key in attributes){elt.setAttributeNS(null,key,attributes[key])}if(content!==undefined){self.clear(elt);elt.appendChild(document.createTextNode(content))}};self.has_class=function(elt,class_name){var class_attr=elt.getAttributeNS(null,"class");return new RegExp("(\\s|^)"+class_name+"(\\s|$)").test(class_attr)};self.add_class=function(elt,class_name){if(!self.has_class(elt,class_name)){elt.setAttributeNS(null,"class",elt.getAttributeNS(null,"class")+" "+class_name)}};self.remove_class=function(elt,class_name){if(self.has_class(elt,class_name)){var class_attr=elt.getAttributeNS(null,"class");var new_class_attr=class_attr.replace(new RegExp("(\\s|^)"+class_name+"(\\s|$)","g"),"$2");elt.setAttributeNS(null,"class",new_class_attr)}};self.update_selector=function(container,selector,attributes,content){var elt=container.querySelector(selector);self.update(elt,attributes,content)};return self}();var TreeDimensions={NODE_WIDTH:30,EMPTY_WIDTH:5,NODE_HEIGHT:50,EMPTY_HEIGHT:25,EMPTY_SIZE:10};var TreeEditor=function($elt,$undo_button,$warning_area){var self={};self.init=function(){self.$elt=$elt;self.$undo_button=$undo_button;self.$warning_area=$warning_area;self.$elt.addClass("tree-editor");self.tree={empty:true};self.svg=SVG.create("svg");$elt.append(self.svg);self.main=SVG.add(self.svg,"g",{"class":"tree-editor-main"});self.$undo_button.click(self.undo);self.bst_warning_enabled=false};self.destroy=function(){self.remove_from_svg(self.tree);self.$undo_button.unbind("click");self.$elt.empty();self.$warning_area.empty()};self.set_tree=function(tree){self.tree=tree;self.clear();self.update_tree();self.setup_undo()};self.enable_bst_warning=function(){self.bst_warning_enabled=true};self.clear=function(){SVG.clear(self.main)};self.update_tree=function(){self.redraw_tree();self.check_bst()};self.redraw_tree=function(){self.calc_dimensions(self.tree);var left_margin,right_margin;if(self.tree.empty){left_margin=right_margin=25}else{left_margin=25+Math.max(0,self.tree.r.width-self.tree.l.width);right_margin=25+Math.max(0,self.tree.l.width-self.tree.r.width)}var width=self.tree.width+left_margin+right_margin;var height=self.tree.height;var start_x=left_margin;var start_y=-TreeDimensions.NODE_HEIGHT+40;SVG.update(self.svg,{width:width,height:height});self.$elt.css({width:width+"px",height:height+"px"});self.calc_positions(self.tree,start_x,start_y);self.draw_tree(self.main,self.tree,null,"root")};self.calc_dimensions=function(tree){if(tree.empty){tree.node_width=TreeDimensions.EMPTY_WIDTH;tree.width=TreeDimensions.EMPTY_WIDTH;tree.height=TreeDimensions.EMPTY_HEIGHT}else{self.calc_dimensions(tree.l);self.calc_dimensions(tree.r);tree.node_width=self.get_node_width(tree.val);tree.width=tree.l.width+tree.r.width+tree.node_width;tree.height=TreeDimensions.NODE_HEIGHT+Math.max(tree.l.height,tree.r.height)}};self.calc_positions=function(tree,x,y){if(tree.empty){tree.x=x+TreeDimensions.EMPTY_WIDTH/2;tree.y=y+TreeDimensions.EMPTY_HEIGHT}else{tree.x=x+tree.l.width+tree.node_width/2;tree.y=y+TreeDimensions.NODE_HEIGHT;self.calc_positions(tree.l,x,tree.y);self.calc_positions(tree.r,x+tree.l.width+tree.node_width,tree.y)}};self.get_node_width=function(value){return Math.max(TreeDimensions.NODE_WIDTH,self.get_text_width(value)+10)};self.draw_tree=function(container,tree,parent,node_type){if(tree.empty){if(!tree.part){tree.part=EmptyTreePart(container,tree,parent,node_type);tree.part.node_elt.onclick=function(){self.add_node(tree)}}tree.part.update()}else{if(!tree.part){tree.part=NonEmptyTreePart(container,tree,parent,node_type);tree.part.edge_elt.onclick=function(){self.remove_node(tree)};tree.part.node_elt.onclick=function(){self.make_editable(tree)}}tree.part.update();self.draw_tree(tree.part.children_elt,tree.l,tree,"left");self.draw_tree(tree.part.children_elt,tree.r,tree,"right")}};self.add_node=function(tree){self.add_undo_action(tree);self.remove_from_svg(tree);tree.empty=false;tree.val=0;tree.l={empty:true};tree.r={empty:true};self.update_tree();self.make_editable(tree);self.scroll_into_view(tree)};self.remove_node=function(tree){self.add_undo_action(tree);self.remove_from_svg(tree);tree.empty=true;tree.l=null;tree.r=null;self.update_tree()};self.remove_from_svg=function(tree){if(!tree.empty){self.remove_from_svg(tree.l);self.remove_from_svg(tree.r)}if(tree.part){tree.part.remove();tree.part=null}};self.flatten=function(tree){if(tree.empty){return[]}else{var flat_left=self.flatten(tree.l);var flat_right=self.flatten(tree.r);return flat_left.concat([tree],flat_right)}};self.check_bst=function(){if(!self.bst_warning_enabled)return;var flat=self.flatten(self.tree);var warning="";var i;for(i=0;i<flat.length;++i){SVG.remove_class(flat[i].part.node_elt,"bst-warning")}for(i=1;i<flat.length;++i){if(flat[i-1].val>=flat[i].val){warning="Warning: this is not a binary search tree ("+flat[i-1].val+" is not less than "+flat[i].val+").";SVG.add_class(flat[i-1].part.node_elt,"bst-warning");SVG.add_class(flat[i].part.node_elt,"bst-warning");break}}self.$warning_area.text(warning)};self.make_editable=function(tree){var $input=$("<input>").val(tree.val);var width=Math.max(self.get_node_width(tree.val),76);$input.css({position:"absolute",left:tree.x+"px",top:tree.y+"px",width:width+"px","margin-left":-width/2+"px"});self.$elt.append($input);$input.focus();$input.select();var editor=IntEditor($input);function exit(){var val=editor.get_value();if(val!==null&&val!==tree.val){self.add_undo_action(tree);tree.val=val;self.update_tree()}$input.remove()}$input.on("keypress",function(e){if(e.which==13)exit()});if(window.TESTING){$input.on("blur-test",exit)}else{$input.on("blur",exit)}};self.setup_undo=function(){self.undo_actions=[];self.$undo_button.prop("disabled",true)};self.add_undo_action=function(tree){self.undo_actions.push({tree:tree,empty:tree.empty,l:tree.l,r:tree.r,val:tree.val});self.$undo_button.prop("disabled",false)};self.undo=function(){if(self.undo_actions.length===0)return;var action=self.undo_actions.pop();self.remove_from_svg(action.tree);action.tree.empty=action.empty;action.tree.l=action.l;action.tree.r=action.r;action.tree.val=action.val;self.update_tree();self.$undo_button.prop("disabled",self.undo_actions.length===0)};self.get_text_width=function(content){var elt=SVG.add(self.main,"text",{},content);var width=elt.getBoundingClientRect().width;self.main.removeChild(elt);return width};self.scroll_into_view=function(tree){var y_bottom=tree.y+tree.height;var $parent=self.$elt.parent();var spill_over=y_bottom-$parent.height()-$parent.scrollTop();if(spill_over>0)$parent.scrollTop($parent.scrollTop()+spill_over)};self.init();return self};var Part=function(container,class_name){var self={};self.group_elt=SVG.add(container,"g",{"class":class_name});self.remove=function(){container.removeChild(self.group_elt)};return self};var EmptyTreePart=function(container,tree,parent,node_type){var self=Part(container,"empty-tree "+node_type);if(parent)self.edge_elt=SVG.add(self.group_elt,"line",{"class":"empty-edge"});self.node_elt=SVG.add(self.group_elt,"rect",{"class":"empty",width:TreeDimensions.EMPTY_SIZE,height:TreeDimensions.EMPTY_SIZE});self.update=function(){if(parent)SVG.update(self.edge_elt,{x1:parent.x,y1:parent.y,x2:tree.x,y2:tree.y});SVG.update(self.node_elt,{x:tree.x-TreeDimensions.EMPTY_SIZE/2,y:tree.y-TreeDimensions.EMPTY_SIZE/2})};return self};var NonEmptyTreePart=function(container,tree,parent,node_type){var self=Part(container,"tree "+node_type);self.edge_elt=SVG.add(self.group_elt,"g",{"class":"edge"});self.thick_elt=SVG.add(self.edge_elt,"line",{"class":"thick"});self.thin_elt=SVG.add(self.edge_elt,"line",{"class":"thin"});self.children_elt=SVG.add(self.group_elt,"g",{"class":"children"});self.node_elt=SVG.add(self.group_elt,"g",{"class":"node"});self.rect_elt=SVG.add(self.node_elt,"rect",{height:TreeDimensions.NODE_WIDTH,rx:TreeDimensions.NODE_WIDTH/2,ry:TreeDimensions.NODE_WIDTH/2});self.text_elt=SVG.add(self.node_elt,"text",{});self.update=function(){var edge_start_x,edge_start_y;if(parent){edge_start_x=parent.x;edge_start_y=parent.y}else{edge_start_x=tree.x;edge_start_y=tree.y-TreeDimensions.NODE_HEIGHT}SVG.update(self.thick_elt,{x1:edge_start_x,y1:edge_start_y,x2:tree.x,y2:tree.y});SVG.update(self.thin_elt,{x1:edge_start_x,y1:edge_start_y,x2:tree.x,y2:tree.y});SVG.update(self.rect_elt,{x:tree.x-tree.node_width/2,y:tree.y-TreeDimensions.NODE_WIDTH/2,width:tree.node_width});SVG.update(self.text_elt,{x:tree.x,y:tree.y+5},tree.val)};return self};var IntEditor=function($input){var self={};self.validate=function(){if(self.get_value()===null)$input.addClass("error");else $input.removeClass("error")};self.get_value=function(){var s=$input.val();if(!/^[+-]?(0|[1-9]\d{0,9})$/.test(s))return null;var n=parseInt(s,10);if(!(-2147483648<=n&&n<=2147483647))return null;return n};$input.attr("maxlength",11).on("change keyup paste",self.validate);return self};function TestServer(){var self={tasks:{task1:{status:"open",human_lang_list:["en","cn"],prg_lang_list:["c","cpp"],type:"algo",saved:null,n_saves:0,allow_modal_editor:false,modal_editor_options:null,example_input:"1"},task2:{status:"open",human_lang_list:["en","cn"],prg_lang_list:["c","cpp"],type:"bugfixing",saved:null,n_saves:0,allow_modal_editor:false,modal_editor_options:null,example_input:"2"},task3:{status:"open",human_lang_list:["en"],prg_lang_list:["sql"],type:"sql",saved:null,n_saves:0,allow_modal_editor:false,modal_editor_options:null,example_input:"3"},task4:{status:"open",human_lang_list:["en"],prg_lang_list:["c"],type:"algo",saved:null,n_saves:0,allow_modal_editor:true,modal_editor_options:JSON.stringify({format:[{name:"T",type:"tree"}]}),example_input:"(25, (19, (12, (4, None, None), None), (22, None, (23, None, None))), (37, (29, None, (30, None, None)), None))"},task5:{status:"open",human_lang_list:["en"],prg_lang_list:["c"],type:"algo",saved:null,n_saves:0,allow_modal_editor:true,modal_editor_options:JSON.stringify({bst:true,format:[{name:"T",type:"tree"}]}),example_input:"(25, (19, (12, (4, None, None), None), (22, None, (23, None, None))), (37, (29, None, (30, None, None)), None))"},task6:{status:"open",human_lang_list:["en"],prg_lang_list:["c"],type:"algo",saved:null,n_saves:0,allow_modal_editor:true,modal_editor_options:JSON.stringify({format:[{name:"A",type:"int"},{name:"B",type:"int"},{name:"T",type:"tree"}]}),example_input:"(10, 20, (15, (12, None, None), None))"}},task_names:["task1","task2","task3","task4","task5","task6"],current_task:"task1",next_task:"",submits:[],time_at_start:1800,timed_out:false,survey_submitted:false};self.use_asserts=true;self.ui_options={ticket_id:"TICKET_ID",time_elapsed_sec:15,time_remaining_sec:1800,current_human_lang:"en",current_prg_lang:"c",current_task_name:"task1",task_names:self.task_names,human_langs:{en:{name_in_itself:"English"},cn:{name_in_itself:"中文"}},prg_langs:{c:{version:"C",name:"C"},sql:{version:"SQL",name:"SQL"},cpp:{version:"C++",name:"C++"}},show_survey:true,show_help:false,show_welcome:true,sequential:false,save_often:true,urls:{status:"/chk/status/",get_task:"/c/_get_task/",submit_survey:"/surveys/_ajax_submit_candidate_survey/TICKET_ID/",clock:"/chk/clock/",close:"/c/close/TICKET_ID",verify:"/chk/verify/",save:"/chk/save/",timeout_action:"/chk/timeout_action/","final":"/chk/final/",start_ticket:"/c/_start/"}};self.respondGetTask=function(data){var task=data.task||self.current_task;var human_lang=data.human_lang;var prg_lang=data.prg_lang;var prefer_server_prg_lang=data.prefer_server_prg_lang;var t=self.tasks[task];if(prefer_server_prg_lang=="true"&&t.saved)prg_lang=t.saved.prg_lang;if(t.prg_lang_list.indexOf(prg_lang)==-1)prg_lang=t.prg_lang_list[0];if(t.human_lang_list.indexOf(human_lang)==-1)human_lang=t.human_lang_list[0];var id=task+","+human_lang+","+prg_lang;var solution=self.getTaskStart(task,human_lang,prg_lang);if(t.saved&&t.saved.prg_lang==prg_lang)solution=t.saved.solution;return{task_status:t.status,task_description:"Description: "+id,task_type:t.type,solution_template:self.getTaskStart(task,human_lang,prg_lang),current_solution:solution,example_input:t.example_input,prg_lang_list:JSON.stringify(t.prg_lang_list),human_lang_list:JSON.stringify(t.human_lang_list),prg_lang:prg_lang,human_lang:human_lang,allow_user_test_cases:t.type!="sql",allow_modal_editor:t.allow_modal_editor,modal_editor_options:t.modal_editor_options}};self.getTaskStart=function(task,human_lang,prg_lang){return"Start: "+task+","+human_lang+","+prg_lang};self.respondSave=function(data){var task=data.task;var prg_lang=data.prg_lang;var solution=data.solution;self.tasks[task].saved={prg_lang:prg_lang,solution:solution};self.tasks[task].n_saves=(self.tasks[task].n_saves||0)+1;return{result:"OK",message:"solution saved"}};self.respondTimeout=function(data){var t=self.getRemainingTime();if(self.use_asserts)expect(t).toBeLessThan(60);self.timed_out=true;return self.respondSave(data)};self.respondSubmit=function(data,mode){var task=data.task;var prg_lang=data.prg_lang;var solution=data.solution;var submit_id=self.submits.length;var submit={mode:mode,task:task,prg_lang:prg_lang,solution:solution,times_polled:0};console.log(data);for(var key in data){if(/^test_data\d+$/.exec(key))submit[key]=data[key]}self.submits.push(submit);self.tasks[task].status="closed";return self.submitStatus(submit_id)};self.respondStatus=function(data){var submit_id=data.id;var submit=self.submits[submit_id];submit.times_polled++;return self.submitStatus(submit_id)};self.submitStatus=function(submit_id){var submit=self.submits[submit_id];var response;if(submit.result){response=$.extend({result:"OK"},submit.result)}else{response={result:"LATER",message:"Request is waiting for evaluation.",id:submit_id,delay:5}}if(submit.mode=="final"){response.next_task=self.getNextTask()}return response};self.getNextTask=function(){return self.next_task};self.getRemainingTime=function(){return self.time_at_start-Math.floor((new Date).valueOf()/1e3)};self.ticket_submitted=false;self.respondClock=function(data){if(self.ticket_submitted){return{result:"ERROR",message:"Test is already closed."}}return{result:"OK",new_timelimit:self.getRemainingTime()}};self.respondStartTicket=function(data){self._startCalled=true;if(self._startError){return{error:"Could not start ticket"}}return{started:"OK"}};self.triggerStartError=function(){self._startError=true};self.triggerTicketNotFound=function(){self._startTicketNotFound=true};self.startCalled=function(){if(self._startCalled){return true}return false};self.respondTo=function(req){if(req.url=="/logs/_multilog/"){return}if(req.aborted){return}if(req.url=="/surveys/_ajax_submit_candidate_survey/TICKET_ID/"){self.survey_submitted=true;req.respond(200,{},"");return}var data=getParams(req.requestBody);if(self.use_asserts){expect(data.ticket).toBe("TICKET_ID");expect(req.method).toBe("POST")}var response;if(req.url=="/c/_get_task/"){response=self.respondGetTask(data)}if(req.url=="/c/_start/"){response=self.respondStartTicket(data);if(self._startTicketNotFound){return req.respond(404,{"Content-Type":"text/xml"},xmlResponse(response))}}if(req.url=="/chk/save/"){response=self.respondSave(data)}if(req.url=="/chk/verify/"){response=self.respondSubmit(data,"verify")}if(req.url=="/chk/final/"){response=self.respondSubmit(data,"final")}if(req.url=="/chk/status/"){response=self.respondStatus(data)}if(req.url=="/chk/clock/"){response=self.respondClock(data)}if(req.url=="/chk/timeout_action/"){response=self.respondTimeout(data)}req.respond(200,{"Content-Type":"text/xml"},xmlResponse(response))};self.requests=[];self.respond=function(timeout){while(self.requests.length>0){var request=self.requests.pop();if(timeout===undefined)self.respondTo(request);else setTimeout($.proxy(self.respondTo,self,request),timeout)}};self.init=function(){self.xhr=sinon.useFakeXMLHttpRequest();self.xhr.onCreate=function(request){self.requests.push(request)}};self.shutdown=function(){self.xhr.restore()};self.verifyOkResponse=function(){return{compile_ok:"1",tests_ok:"1",html:'<div class="title summary success">Verification succeeded</div>'}};self.verifyFailedResponse=function(){return{compile_ok:"1",tests_ok:"0",html:"Verification failed"}};function jsonToXml(data){if(data===null)return"null";if(typeof data=="string")return data.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;");if(typeof data!="object")return data;function toXml(tag,content){return"<"+tag+">"+jsonToXml(content)+"</"+tag+">"}var ret="";$.each(data,function(tag,content){ret+=toXml(tag,content)});return ret}function xmlResponse(data){var ret='<?xml version="1.0" encoding="UTF-8"?>';ret+="<response>";ret+=jsonToXml(data);ret+="</response>";jQuery.parseXML(ret);return ret}return self}function LocalServer(){var self=TestServer();self.use_asserts=false;var super_init=self.init;self.init=function(){super_init();setTimeout(self.beat,self.BEAT_PERIOD)};self.BEAT_PERIOD=200;self.RESPONSE_DELAY=150;self.VERIFY_DELAY=700;self.beat=function(){self.respond(self.RESPONSE_DELAY);self.verifySubmits(self.VERIFY_DELAY);setTimeout(self.beat,self.BEAT_PERIOD)};self.getNextTask=function(){for(var i=0;i<self.task_names.length;i++){var task_name=self.task_names[i];if(self.tasks[task_name].status!="closed")return task_name}return""};self.verifySubmits=function(timeout){for(var i=0;i<self.submits.length;i++){var submit=self.submits[i];if(submit.mode!="verify"||submit.result||submit.in_eval)continue;setTimeout($.proxy(self.verifySubmit,self,submit),timeout);submit.in_eval=true}};self.verifySubmit=function(submit){submit.in_eval=false;if(/^ *fail()/im.test(submit.solution)){submit.result={compile:{ok:1,message:"The solution compiled flawlessly."},example:{ok:0,message:"RUNTIME ERROR (you invoked the fail() function)"}}}else{submit.result={compile:{ok:1,message:"The solution compiled flawlessly."},example:{ok:1,message:"OK"}}}};self.getTaskStart=function(task,human_lang,prg_lang){var header=["","// You're running an in-browser mock server for the CUI.","// It will allow you to test the interface, but will not","// actually assess the solutions.","",'// This is a starting solution for task="'+task+'", prg_lang="'+prg_lang+'".',""].join("\n");var sol;if(prg_lang=="sql"){sol=["FAIL; -- comment this out for the solution to pass","","SELECT 42;"].join("\n");header=header.replace(/\/\/ /g,"-- ")}else{sol=["int solution() {","    fail(); // comment this out for the solution to pass","","    return 42;","}"].join("\n")}return header+"\n"+sol};return self}
//# sourceMappingURL=/static/js/8f0b4621e03f.js.map